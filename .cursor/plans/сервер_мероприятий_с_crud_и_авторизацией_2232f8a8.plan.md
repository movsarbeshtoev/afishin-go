---
name: Сервер мероприятий с CRUD и авторизацией
overview: Создание REST API сервера на Go с полным CRUD для мероприятий, фильтрацией по различным параметрам, регистрацией и авторизацией пользователей через JWT токены.
todos:
  - id: todo-1768948048016-r6u2k7art
    content: ""
    status: pending
---

# План: REST API сервер для управления мероприятиями

## Архитектура

Сервер будет построен на стандартной библиотеке Go (`net/http`) с использованием:

- **GORM** для работы с базой данных (SQLite)
- **JWT** для авторизации
- **REST API** для всех операций

## Структура данных

### Модель Event (Мероприятие)

- `ID` - уникальный идентификатор
- `Title` - название мероприятия
- `Description` - описание
- `Category` - категория (строка)
- `Date` - дата проведения
- `Time` - время проведения (опционально)
- `Location` - место проведения
- `Price` - цена (float64, может быть 0 для бесплатных)
- `MaxAttendees` - максимальное количество участников
- `CreatedBy` - ID пользователя-создателя (связь с User)
- `CreatedAt`, `UpdatedAt` - временные метки

### Модель User (обновление)

- `ID` - уникальный идентификатор
- `Name` - имя пользователя
- `Email` - email (уникальный)
- `Password` - хешированный пароль
- `CreatedAt`, `UpdatedAt` - временные метки

## API Endpoints

### Аутентификация

- `POST /api/auth/register` - регистрация нового пользователя
- `POST /api/auth/login` - вход (возвращает JWT токен)

### Мероприятия (CRUD)

- `GET /api/events` - список мероприятий с фильтрацией
- `GET /api/events/:id` - получение одного мероприятия
- `POST /api/events` - создание мероприятия (требует авторизации)
- `PUT /api/events/:id` - обновление мероприятия (только создатель)
- `DELETE /api/events/:id` - удаление мероприятия (только создатель)

### Параметры фильтрации для GET /api/events

- `category` - фильтр по категории
- `date_from` - мероприятия с этой даты
- `date_to` - мероприятия до этой даты
- `location` - фильтр по месту
- `price_min` - минимальная цена
- `price_max` - максимальная цена
- `created_by` - фильтр по создателю

## Реализация

### Файлы для создания/изменения

1. **[main.go](main.go)** - основной файл с роутингом и middleware

- Настройка базы данных
- Регистрация всех маршрутов
- Middleware для JWT авторизации
- Обработчики HTTP запросов

2. **Новый файл: `models.go`** - модели данных

- Структуры `User` и `Event`
- Методы для работы с паролями (хеширование, проверка)

3. **Новый файл: `handlers.go`** - обработчики HTTP запросов

- `RegisterHandler` - регистрация
- `LoginHandler` - вход
- `GetEventsHandler` - список с фильтрацией
- `GetEventHandler` - одно мероприятие
- `CreateEventHandler` - создание
- `UpdateEventHandler` - обновление
- `DeleteEventHandler` - удаление

4. **Новый файл: `middleware.go`** - middleware функции

- `AuthMiddleware` - проверка JWT токена
- `CORSMiddleware` - настройка CORS (для фронтенда)

5. **Новый файл: `utils.go`** - вспомогательные функции

- Генерация и проверка JWT токенов
- Хеширование паролей (bcrypt)
- Валидация данных

### Зависимости для добавления

Обновить `go.mod` с пакетами:

- `github.com/golang-jwt/jwt/v5` - для JWT токенов
- `golang.org/x/crypto/bcrypt` - для хеширования паролей

## Последовательность реализации

1. Обновить модели данных (`User` и создать `Event`)
2. Добавить утилиты для работы с паролями и JWT
3. Реализовать endpoints для регистрации и входа
4. Создать middleware для авторизации
5. Реализовать CRUD операции для мероприятий
6. Добавить фильтрацию в GET /api/events
7. Добавить проверку прав доступа (только создатель может редактировать/удалять)

## Особенности для обучения

- Код будет содержать комментарии на русском языке
- Простая структура без излишнего усложнения
- Использование стандартной библио